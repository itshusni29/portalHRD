{% extends 'layouts/base.html' %}
{% load static %}

{% block title %} Dashboard {% endblock title %}

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
<link rel="stylesheet" href="{% static 'assets/css/apexcharts.css' %}">
<style>
  #mixed-chart {
    margin: 35px auto;
  }

  .apexcharts-tooltip {
    z-index: 10;
    pointer-events: unset;
  }

  .apexcharts-tooltip a {
    cursor: pointer;
  }

  .apexcharts-tooltip span {
    padding: 5px 10px;
    display: inline-block;
  }

  .apexcharts-tooltip.apexcharts-tooltip-active {
    opacity: 1;
    transition: 0.15s ease all;
  }

  /* Custom styles for rounded border with primary color */
  .rounded-border-primary {
    border-radius: 15px; /* Adjust as needed for the roundness */
    border: 4px solid #007bff; /* Primary color border, adjust color as needed */
    padding: 20px; /* Add padding inside the border */
  }
</style>
{% endblock stylesheets %}

{% block content %}

    <!-- Header -->
    <div class="header bg-white pb-6">
      <div class="container-fluid">
        <div class="header-body">
          <div class="row py-4">
            <div class="col-lg-12" style="text-align: right;">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Page content -->
    <div class="container-fluid mt--6 bg-white">
      <div class="row">
        <div class="col-md-10 mx-auto">
          <div class="card card-stats">
            <div class="card-body">
              <h1 class="text-center">{{ grafik.nama }}</h1>


              <div class="col-md-10 mx-auto rounded-border-primary">
                <!-- Chart Container -->
                <div id="mixed-chart"></div>
              </div>
              
            </div>
          </div>
        </div>
      </div>
      <a id="scrollToTop" href="#" title="Go to top"><i class="ni ni-bold-up"></i></a>
    </div>

   <!-- Include ApexCharts JS -->
<script src="{% static 'assets/js/apexchart/apexcharts.min.js' %}"></script>
<script>
  // Parse the JSON data from Django
  var grafikData = JSON.parse('{{ grafik_data|escapejs }}');
  
  // Extract the `nama` from the first data item (assuming you have only one for now)
  var nama = grafikData.length > 0 ? grafikData[0].nama : '';

  // Extract data for chart
  var dataAktual = grafikData[0] ? Object.values(grafikData[0]).slice(1) : []; // Skipping the first element which is `nama`
  var labels = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];

  // Configuration for the mixed chart
  var options = {
    series: [{
      name: 'Aktual',
      type: 'column',
      data: dataAktual
    }, {
      name: 'Target',
      type: 'line',
      data: [95, 95, 95, 95, 95, 95, 95, 95, 95, 95, 95, 95].map(value => Math.round(value))
    }],
    chart: {
      height: 450,
      type: 'line',
      stacked: false,
    },
    stroke: {
      width: [0, 6],
      curve: 'smooth'
    },
    plotOptions: {
      bar: {
        columnWidth: '50%'
      }
    },
    fill: {
      opacity: [0.85, 0.75],
      gradient: {
        inverseColors: false,
        shade: 'light',
        type: "vertical",
        opacityFrom: 0.85,
        opacityTo: 0.55,
        stops: [0, 100, 100, 100]
      }
    },
    labels: labels,
    markers: {
      size: 6
    },
    xaxis: {
      type: 'category',
      categories: labels
    },
    yaxis: {
      title: {
        text: 'Aktual (%)'
      },
      min: 50,
      max: 100,
      labels: {
        formatter: function (value) {
          return value.toFixed(1) + "%";
        }
      }
    },
    tooltip: {
      shared: true,
      intersect: false,
      custom: function({ series, seriesIndex, dataPointIndex, w }) {
        return (
          '<div class="custom-tooltip">' +
          "<span><b>" + w.config.xaxis.categories[dataPointIndex] + "</b></span><br/>" +
          "<span>Aktual: " + series[0][dataPointIndex].toFixed(1) + "%</span><br/>" +
          "<span>Target: " + series[1][dataPointIndex] + "%</span>" +
          "</div>"
        );
      }
    }
  };

  // Initialize and render the chart
  var chart = new ApexCharts(document.querySelector("#mixed-chart"), options);
  chart.render();
</script>


{% endblock content %}
